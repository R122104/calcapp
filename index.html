<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚ãã‚ãè¨ˆç®—ã‚«ãƒ¼ãƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Hiragino Maru Gothic ProN', 'Rounded Mplus 1c', 'Kosugi Maru', sans-serif;
        }

        body {
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
        }

        .app-container {
            width: 100%;
            max-width: 380px;
            margin: 0 auto;
        }

        .card {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
        #start-screen {
            padding: 20px;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .big-emoji {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .settings-options {
            margin-bottom: 20px;
        }

        .setting-row {
            margin-bottom: 15px;
        }

        .setting-label {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .setting-buttons {
            display: flex;
            gap: 10px;
        }

        .option-btn, .op-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid #dee2e6;
            background-color: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
        }

        .option-btn.active, .op-btn.active {
            background-color: #4285f4;
            color: white;
            font-weight: bold;
        }

        .start-btn {
            width: 100%;
            padding: 12px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        #game-screen {
            display: none;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† */
        .header {
            padding: 10px;
        }

        .title {
            background-color: #4285f4;
            color: white;
            padding: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .emoji {
            font-size: 28px;
            margin-right: 10px;
        }

        h1 {
            font-size: 22px;
            font-weight: 700;
            margin: 0;
        }

        /* é€²æ—ãƒãƒ¼ */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background-color: #f1f3f5;
            border-radius: 8px;
        }

        .progress-text {
            font-weight: bold;
        }

        .points {
            background-color: #4285f4;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        /* å•é¡Œã‚«ãƒ¼ãƒ‰ */
        .problem-card {
            background-color: #e7f5ff;
            margin: 10px;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .problem {
            font-size: 32px;
            font-weight: bold;
        }

        .number {
            display: inline-block;
            background-color: white;
            width: 50px;
            height: 50px;
            line-height: 50px;
            border-radius: 8px;
            margin: 0 5px;
        }

        .operator {
            display: inline-block;
            margin: 0 5px;
        }

        .equals {
            display: inline-block;
            margin: 0 5px;
        }

        .answer-placeholder {
            display: inline-block;
            background-color: #fa5252;
            color: white;
            width: 50px;
            height: 50px;
            line-height: 50px;
            border-radius: 8px;
            margin: 0 5px;
        }

        /* å›ç­”ã‚¨ãƒªã‚¢ */
        .answer-area {
            padding: 0 10px 15px;
        }

        .message-box {
            text-align: center;
            margin-bottom: 15px;
            padding: 8px;
            border-radius: 8px;
            background-color: #f1f3f5;
        }

        .message-box.correct {
            background-color: #ebfbee;
            color: #12b886;
        }

        .message-box.incorrect {
            background-color: #fff5f5;
            color: #fa5252;
        }

        /* æ•°å­—ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ */
        .number-pad {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .number-row {
            display: flex;
            gap: 8px;
        }

        .number-key, .delete-key, .check-answer-btn {
            flex: 1;
            aspect-ratio: 1;
            padding: 10px;
            border: 1px solid #dee2e6;
            background-color: white;
            border-radius: 8px;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
        }

        .delete-key {
            background-color: #ffa8a8;
            color: #212529;
        }

        .check-answer-btn {
            flex: 1;
            aspect-ratio: initial;
            background-color: #4285f4;
            color: white;
            font-size: 16px;
        }

        /* çµæœç”»é¢ */
        #result-screen {
            display: none;
            padding: 15px;
        }

        .result-header {
            background-color: #fff3bf;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
        }

        .result-stats {
            background-color: #f1f3f5;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .stat-label {
            font-weight: bold;
        }

        .retry-btn, .review-btn {
            width: 100%;
            padding: 12px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 15px;
        }

        #review-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        #review-area h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .review-problem {
            background-color: #f1f3f5;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        /* æ­£è§£ãƒ»ä¸æ­£è§£è¡¨ç¤ºç”¨ */
        .correct {
            color: #12b886;
        }

        .incorrect {
            color: #fa5252;
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .pop {
            animation: pop 0.3s;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="card">
            <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
            <div id="start-screen">
                <div class="settings-header">
                    <div class="big-emoji">ğŸ˜Š</div>
                    <h2>ã‚ãã‚ãè¨ˆç®—ã‚«ãƒ¼ãƒ‰</h2>
                </div>
                
                <div class="settings-options">
                    <div class="setting-row">
                        <div class="setting-label">ã‚€ãšã‹ã—ã•:</div>
                        <div class="setting-buttons">
                            <button class="option-btn active" id="easy-btn">ã‹ã‚“ãŸã‚“</button>
                            <button class="option-btn" id="normal-btn">ãµã¤ã†</button>
                            <button class="option-btn" id="hard-btn">ã‚€ãšã‹ã—ã„</button>
                        </div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">ã‚‚ã‚“ã ã„ã™ã†:</div>
                        <div class="setting-buttons">
                            <button class="option-btn" data-value="5">5</button>
                            <button class="option-btn active" data-value="10">10</button>
                            <button class="option-btn" data-value="20">20</button>
                        </div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">ã‘ã„ã•ã‚“ã—ã‚…ã‚‹ã„:</div>
                        <div class="setting-buttons">
                            <button class="op-btn active" data-op="+">+</button>
                            <button class="op-btn" data-op="-">-</button>
                            <button class="op-btn" data-op="Ã—">Ã—</button>
                            <button class="op-btn" data-op="Ã·">Ã·</button>
                        </div>
                    </div>
                </div>
                
                <button id="start-btn" class="start-btn">ã¯ã˜ã‚ã‚‹</button>
            </div>

            <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
            <div id="game-screen">
                <!-- ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† -->
                <div class="header">
                    <div class="title">
                        <div class="emoji">ğŸ˜Š</div>
                        <h1>ã‚ãã‚ãè¨ˆç®—ã‚«ãƒ¼ãƒ‰</h1>
                    </div>
                    
                    <!-- é€²æ—è¡¨ç¤º -->
                    <div class="progress-bar">
                        <div class="progress-text">
                            <span id="current-problem">1</span> / <span id="total-problems">10</span>
                        </div>
                        <div class="points" id="points">100ã´ã‚‡ã†</div>
                    </div>
                </div>
                
                <!-- å•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div class="problem-card">
                    <div class="problem">
                        <span id="num1" class="number">7</span>
                        <span id="operator" class="operator">+</span>
                        <span id="num2" class="number">5</span>
                        <span class="equals">=</span>
                        <span class="answer-placeholder">?</span>
                    </div>
                </div>
                
                <!-- å›ç­”å…¥åŠ›ã‚¨ãƒªã‚¢ -->
                <div class="answer-area">
                    <div class="message-box" id="message-box">ã“ãŸãˆã‚’ã„ã‚Œã¦ã­</div>
                    
                    <!-- æ•°å­—ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ -->
                    <div class="number-pad">
                        <div class="number-row">
                            <button class="number-key" data-value="1">1</button>
                            <button class="number-key" data-value="2">2</button>
                            <button class="number-key" data-value="3">3</button>
                        </div>
                        <div class="number-row">
                            <button class="number-key" data-value="4">4</button>
                            <button class="number-key" data-value="5">5</button>
                            <button class="number-key" data-value="6">6</button>
                        </div>
                        <div class="number-row">
                            <button class="number-key" data-value="7">7</button>
                            <button class="number-key" data-value="8">8</button>
                            <button class="number-key" data-value="9">9</button>
                        </div>
                        <div class="number-row">
                            <button class="number-key" data-value="0">0</button>
                            <button class="delete-key" id="delete-btn">ã‘ã™</button>
                            <button id="check-btn" class="check-answer-btn">ã“ãŸãˆã‚ã‚ã›</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çµæœç”»é¢ -->
            <div id="result-screen">
                <div class="result-header">
                    <h2>ãŠã¤ã‹ã‚Œã•ã¾ï¼</h2>
                    <div class="result-message">ã¨ã¦ã‚‚ã˜ã‚‡ã†ãšã«ã§ããŸã­ï¼</div>
                </div>
                
                <div class="result-stats">
                    <div class="stat-row">
                        <div class="stat-label">ã›ã„ã‹ã„:</div>
                        <div class="stat-value"><span id="correct-count">8</span>/<span id="total-count">10</span>ã‚‚ã‚“</div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-label">ã‹ã‹ã£ãŸã˜ã‹ã‚“:</div>
                        <div class="stat-value"><span id="minutes">2</span>ãµã‚“<span id="seconds">15</span>ã³ã‚‡ã†</div>
                    </div>
                </div>
                
                <button id="retry-btn" class="retry-btn">ã‚‚ã†ã„ã¡ã© ã‚„ã‚‹</button>
                
                <!-- é–“é•ãˆãŸå•é¡Œã®å¾©ç¿’ã‚¨ãƒªã‚¢ -->
                <div id="review-area">
                    <h3>ã¾ã¡ãŒãˆãŸã‚‚ã‚“ã ã„</h3>
                    <div id="review-problems"></div>
                    <button id="review-btn" class="review-btn">ã‚‚ã†ä¸€åº¦ã‚„ã£ã¦ã¿ã‚‹</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentNum1 = 0;
        let currentNum2 = 0;
        let currentOperator = '+';
        let correctCount = 0;
        let totalCount = 0;
        let maxProblems = 10;
        let startTime = 0;
        let wrongProblems = [];
        let currentAnswer = '';
        let problemResults = [];
        let userSettings = {
            difficulty: 'easy',
            operators: ['+'],
            problemCount: 10,
            maxNumber: 10
        };

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', init);

        function init() {
            // æ•°å­—ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            const numberKeys = document.querySelectorAll('.number-key');
            numberKeys.forEach(key => {
                key.addEventListener('click', () => {
                    const number = key.getAttribute('data-value');
                    addNumberToAnswer(number);
                });
            });

            // å‰Šé™¤ãƒœã‚¿ãƒ³
            const deleteButton = document.getElementById('delete-btn');
            deleteButton.addEventListener('click', deleteLastDigit);

            // ãƒã‚§ãƒƒã‚¯ãƒœã‚¿ãƒ³
            const checkButton = document.getElementById('check-btn');
            checkButton.addEventListener('click', checkAnswer);

            // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³
            const startButton = document.getElementById('start-btn');
            startButton.addEventListener('click', startGame);

            // ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³
            const retryButton = document.getElementById('retry-btn');
            retryButton.addEventListener('click', () => {
                hideScreen('result-screen');
                showScreen('start-screen');
            });

            // å¾©ç¿’ãƒœã‚¿ãƒ³
            const reviewButton = document.getElementById('review-btn');
            reviewButton.addEventListener('click', reviewWrongProblems);

            // é›£æ˜“åº¦è¨­å®š
            const easyBtn = document.getElementById('easy-btn');
            const normalBtn = document.getElementById('normal-btn');
            const hardBtn = document.getElementById('hard-btn');
            
            easyBtn.addEventListener('click', () => setDifficulty('easy'));
            normalBtn.addEventListener('click', () => setDifficulty('normal'));
            hardBtn.addEventListener('click', () => setDifficulty('hard'));

            // æ¼”ç®—å­ãƒœã‚¿ãƒ³
            const opButtons = document.querySelectorAll('.op-btn');
            opButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const op = btn.getAttribute('data-op');
                    toggleOperator(btn, op);
                });
            });

            // å•é¡Œæ•°ãƒœã‚¿ãƒ³
            const optionButtons = document.querySelectorAll('.option-btn[data-value]');
            optionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const value = parseInt(btn.getAttribute('data-value'));
                    setProblemCount(btn, value);
                });
            });

            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›
            document.addEventListener('keydown', handleKeyboardInput);

            // åˆæœŸçŠ¶æ…‹ã®è¨­å®š
            showScreen('start-screen');
            hideScreen('game-screen');
            hideScreen('result-screen');
        }

        // ç”»é¢è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function showScreen(screenId) {
            document.getElementById(screenId).style.display = 'block';
        }

        function hideScreen(screenId) {
            document.getElementById(screenId).style.display = 'none';
        }

        // é›£æ˜“åº¦è¨­å®š
        function setDifficulty(difficulty) {
            userSettings.difficulty = difficulty;
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('#easy-btn, #normal-btn, #hard-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(difficulty + '-btn').classList.add('active');
            
            if (difficulty === 'easy') {
                userSettings.maxNumber = 10;
            } else if (difficulty === 'normal') {
                userSettings.maxNumber = 20;
            } else {
                userSettings.maxNumber = 30;
            }
        }

        // æ¼”ç®—å­è¨­å®š
        function toggleOperator(button, operator) {
            button.classList.toggle('active');
            
            if (button.classList.contains('active')) {
                // æ¼”ç®—å­ã‚’è¿½åŠ 
                if (!userSettings.operators.includes(operator)) {
                    userSettings.operators.push(operator);
                }
            } else {
                // æ¼”ç®—å­ã‚’å‰Šé™¤ï¼ˆãŸã ã—å°‘ãªãã¨ã‚‚1ã¤ã¯å¿…è¦ï¼‰
                if (userSettings.operators.length > 1) {
                    userSettings.operators = userSettings.operators.filter(op => op !== operator);
                } else {
                    // æœ€å¾Œã®1ã¤ã¯å‰Šé™¤ã§ããªã„ã‚ˆã†ã«ã™ã‚‹
                    button.classList.add('active');
                }
            }
        }

        // å•é¡Œæ•°è¨­å®š
        function setProblemCount(button, count) {
            userSettings.problemCount = count;
            maxProblems = count;
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.option-btn[data-value]').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            // æ¼”ç®—å­ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (userSettings.operators.length === 0) {
                alert('ã‘ã„ã•ã‚“ã®ã—ã‚…ã‚‹ã„ã‚’ ãˆã‚‰ã‚“ã§ãã ã•ã„');
                return;
            }
            
            // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
            correctCount = 0;
            totalCount = 0;
            problemResults = [];
            wrongProblems = [];
            
            // æœ€å¤§å•é¡Œæ•°ã®è¨­å®š
            maxProblems = userSettings.problemCount;
            document.getElementById('total-problems').textContent = maxProblems;
            
            // é–‹å§‹æ™‚é–“ã‚’è¨˜éŒ²
            startTime = Date.now();
            
            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            hideScreen('start-screen');
            hideScreen('result-screen');
            showScreen('game-screen');
            
            // æœ€åˆã®å•é¡Œã‚’ç”Ÿæˆ
            generateProblem();
        }

        // å•é¡Œç”Ÿæˆ
        function generateProblem() {
            // å•é¡Œæ•°ã«é”ã—ãŸã‚‰ã‚²ãƒ¼ãƒ çµ‚äº†
            if (totalCount >= maxProblems) {
                endGame();
                return;
            }
            
            // å•é¡Œç•ªå·ã‚’æ›´æ–°
            document.getElementById('current-problem').textContent = totalCount + 1;
            
            const maxNumber = userSettings.maxNumber;
            
            // ç¾åœ¨ã®å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ
            currentAnswer = '';
            document.querySelector('.answer-placeholder').textContent = '?';
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°
            document.getElementById('message-box').textContent = 'ã“ãŸãˆã‚’ã„ã‚Œã¦ã­';
            document.getElementById('message-box').className = 'message-box';
            
            // æ¼”ç®—å­ã®é¸æŠ
            currentOperator = userSettings.operators[Math.floor(Math.random() * userSettings.operators.length)];
            document.getElementById('operator').textContent = currentOperator;
            
            if (currentOperator === '+') {
                // ãŸã—ã–ã‚“ã®å ´åˆ
                currentNum1 = Math.floor(Math.random() * maxNumber) + 1;
                currentNum2 = Math.floor(Math.random() * maxNumber) + 1;
            } else if (currentOperator === '-') {
                // ã²ãã–ã‚“ã®å ´åˆï¼ˆç­”ãˆãŒè² ã«ãªã‚‰ãªã„ã‚ˆã†ã«ï¼‰
                currentNum1 = Math.floor(Math.random() * maxNumber) + 1;
                currentNum2 = Math.floor(Math.random() * currentNum1) + 1;
            } else if (currentOperator === 'Ã—') {
                // ã‹ã‘ã–ã‚“ã®å ´åˆ
                currentNum1 = Math.floor(Math.random() * (maxNumber / 2)) + 1;
                currentNum2 = Math.floor(Math.random() * (maxNumber / 2)) + 1;
            } else if (currentOperator === 'Ã·') {
                // ã‚ã‚Šã–ã‚“ã®å ´åˆï¼ˆå‰²ã‚Šåˆ‡ã‚Œã‚‹å•é¡Œã®ã¿ï¼‰
                generateDivisionProblem(maxNumber);
            }
            
            document.getElementById('num1').textContent = currentNum1;
            document.getElementById('num2').textContent = currentNum2;
            
            // æ®‹ã‚Šãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º
            document.getElementById('points').textContent = `${(maxProblems - totalCount) * 10}ã´ã‚‡ã†`;
        }

        // å‰²ã‚Šç®—å•é¡Œç”Ÿæˆï¼ˆå‰²ã‚Šåˆ‡ã‚Œã‚‹å•é¡Œã®ã¿ï¼‰
        function generateDivisionProblem(maxNumber) {
            // é›£æ˜“åº¦ã«å¿œã˜ã¦é™¤æ•°ï¼ˆå‰²ã‚‹æ•°ï¼‰ã®æœ€å¤§å€¤ã‚’è¨­å®š
            let maxDivisor;
            if (userSettings.difficulty === 'easy') {
                maxDivisor = 5;
            } else if (userSettings.difficulty === 'normal') {
                maxDivisor = 9;
            } else {
                maxDivisor = 12;
            }
            
            // é™¤æ•°ï¼ˆå‰²ã‚‹æ•°ï¼‰ã‚’æ±ºå®šï¼ˆ1ã¯é™¤ãï¼‰
            currentNum2 = Math.floor(Math.random() * (maxDivisor - 1)) + 2;
            
            // å•†ï¼ˆç­”ãˆï¼‰ã‚’æ±ºå®š
            const maxQuotient = Math.min(Math.floor(maxNumber / currentNum2), 10);
            const quotient = Math.floor(Math.random() * maxQuotient) + 1;
            
            // è¢«é™¤æ•°ï¼ˆå‰²ã‚‰ã‚Œã‚‹æ•°ï¼‰ã‚’è¨ˆç®—
            currentNum1 = currentNum2 * quotient;
        }

        // æ•°å­—å…¥åŠ›
        function addNumberToAnswer(number) {
            // 3æ¡ã¾ã§ã®å…¥åŠ›ã‚’è¨±å¯
            if (currentAnswer.length < 3) {
                currentAnswer += number;
                const answerPlaceholder = document.querySelector('.answer-placeholder');
                answerPlaceholder.textContent = currentAnswer;
                answerPlaceholder.classList.add('pop');
                setTimeout(() => {
                    answerPlaceholder.classList.remove('pop');
                }, 300);
            }
        }

        // å…¥åŠ›ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°
        function deleteLastDigit() {
            if (currentAnswer.length > 0) {
                // æœ€å¾Œã®1æ–‡å­—ã‚’å‰Šé™¤
                currentAnswer = currentAnswer.slice(0, -1);
                
                // è¡¨ç¤ºã‚’æ›´æ–°
                const answerPlaceholder = document.querySelector('.answer-placeholder');
                answerPlaceholder.textContent = currentAnswer === '' ? '?' : currentAnswer;
                answerPlaceholder.classList.add('pop');
                setTimeout(() => {
                    answerPlaceholder.classList.remove('pop');
                }, 300);
            }
        }

        // ç­”ãˆåˆã‚ã›
        function checkAnswer() {
            if (currentAnswer === '') {
                document.getElementById('message-box').textContent = 'ã“ãŸãˆã‚’ ã«ã‚…ã†ã‚Šã‚‡ãã—ã¦ã­';
                return;
            }
            
            let correctAnswer;
            if (currentOperator === '+') {
                correctAnswer = currentNum1 + currentNum2;
            } else if (currentOperator === '-') {
                correctAnswer = currentNum1 - currentNum2;
            } else if (currentOperator === 'Ã—') {
                correctAnswer = currentNum1 * currentNum2;
            } else if (currentOperator === 'Ã·') {
                correctAnswer = currentNum1 / currentNum2;
            }
            
            const isCorrect = parseInt(currentAnswer) === correctAnswer;
            
            // çµæœã‚’è¨˜éŒ²
            totalCount++;
            if (isCorrect) {
                correctCount++;
                document.getElementById('message-box').textContent = 'ã›ã„ã‹ã„ï¼';
                document.getElementById('message-box').className = 'message-box correct';
            } else {
                document.getElementById('message-box').textContent = `ã–ã‚“ã­ã‚“ï¼ ã“ãŸãˆã¯ ${correctAnswer}`;
                document.getElementById('message-box').className = 'message-box incorrect';
                
                // é–“é•ãˆãŸå•é¡Œã‚’è¨˜éŒ²
                wrongProblems.push({
                    num1: currentNum1,
                    num2: currentNum2,
                    operator: currentOperator,
                    correctAnswer: correctAnswer,
                    userAnswer: currentAnswer
                });
            }
            
            // çµæœã‚’é…åˆ—ã«ä¿å­˜
            problemResults.push({
                num1: currentNum1,
                num2: currentNum2,
                operator: currentOperator,
                userAnswer: parseInt(currentAnswer),
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            });
            
            // å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ¬¡ã®å•é¡Œã¸
            setTimeout(() => {
                generateProblem();
            }, 1000);
        }

        // ã‚²ãƒ¼ãƒ çµ‚äº†
        function endGame() {
            const endTime = Date.now();
            const totalTimeInSeconds = Math.floor((endTime - startTime) / 1000);
            const minutes = Math.floor(totalTimeInSeconds / 60);
            const seconds = totalTimeInSeconds % 60;
            
            // çµæœè¡¨ç¤º
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('total-count').textContent = totalCount;
            document.getElementById('minutes').textContent = minutes;
            document.getElementById('seconds').textContent = seconds;
            
            // çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const resultMessageElement = document.querySelector('.result-message');
            if (correctCount === totalCount) {
                resultMessageElement.textContent = 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ã™ã”ã„ã­ï¼';
            } else if (correctCount / totalCount >= 0.8) {
                resultMessageElement.textContent = 'ã¨ã¦ã‚‚ã˜ã‚‡ã†ãšã«ã§ããŸã­ï¼';
            } else if (correctCount / totalCount >= 0.6) {
                resultMessageElement.textContent = 'ã‚ˆããŒã‚“ã°ã£ãŸã­ï¼';
            } else {
                resultMessageElement.textContent = 'ã¤ãã¯ã‚‚ã£ã¨ãŒã‚“ã°ã‚ã†ï¼';
            }
            
            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            hideScreen('game-screen');
            showScreen('result-screen');
            
            // é–“é•ãˆãŸå•é¡ŒãŒã‚ã‚Œã°å¾©ç¿’ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
            if (wrongProblems.length > 0) {
                showWrongProblems();
            } else {
                document.getElementById('review-area').style.display = 'none';
            }
        }

        // é–“é•ãˆãŸå•é¡Œã‚’è¡¨ç¤º
        function showWrongProblems() {
            const reviewArea = document.getElementById('review-area');
            const reviewProblemsElement = document.getElementById('review-problems');
            
            reviewProblemsElement.innerHTML = '';
            
            wrongProblems.forEach(problem => {
                const problemElement = document.createElement('div');
                problemElement.className = 'review-problem';
                problemElement.innerHTML = `
                    ${problem.num1} ${problem.operator} ${problem.num2} = <span class="correct">${problem.correctAnswer}</span>
                    (ã‚ãªãŸ: <span class="incorrect">${problem.userAnswer}</span>)
                `;
                reviewProblemsElement.appendChild(problemElement);
            });
            
            reviewArea.style.display = 'block';
        }

        // é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’
        function reviewWrongProblems() {
            // é–“é•ãˆãŸå•é¡Œã ã‘ã§ã‚²ãƒ¼ãƒ ã‚’å†é–‹
            maxProblems = wrongProblems.length;
            const tempWrongProblems = [...wrongProblems];
            wrongProblems = [];
            
            // å¾©ç¿’ã‚¨ãƒªã‚¢ã‚’éè¡¨ç¤º
            document.getElementById('review-area').style.display = 'none';
            hideScreen('result-screen');
            
            // ã‚²ãƒ¼ãƒ å†é–‹
            startGame();
            
            // é€šå¸¸ã®å•é¡Œç”Ÿæˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦é–“é•ãˆãŸå•é¡Œã‚’ä½¿ã†
            const originalGenerateProblem = generateProblem;
            generateProblem = function() {
                if (totalCount >= maxProblems || tempWrongProblems.length === 0) {
                    endGame();
                    return;
                }
                
                // å•é¡Œç•ªå·ã‚’æ›´æ–°
                document.getElementById('current-problem').textContent = totalCount + 1;
                
                const problem = tempWrongProblems.pop();
                currentNum1 = problem.num1;
                currentNum2 = problem.num2;
                currentOperator = problem.operator;
                
                document.getElementById('num1').textContent = currentNum1;
                document.getElementById('num2').textContent = currentNum2;
                document.getElementById('operator').textContent = currentOperator;
                
                // æ®‹ã‚Šãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º
                document.getElementById('points').textContent = `${(maxProblems - totalCount) * 10}ã´ã‚‡ã†`;
            }
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›å‡¦ç†
        function handleKeyboardInput(event) {
            // æ•°å­—ã‚­ãƒ¼ (0-9)
            if (event.key >= '0' && event.key <= '9') {
                addNumberToAnswer(event.key);
            } 
            // Enterã‚­ãƒ¼ï¼ˆç­”ãˆåˆã‚ã›ï¼‰
            else if (event.key === 'Enter') {
                checkAnswer();
            } 
            // Backspaceã‚­ãƒ¼ï¼ˆ1æ–‡å­—å‰Šé™¤ï¼‰
            else if (event.key === 'Backspace') {
                deleteLastDigit();
            }
        }
    </script>
</body>
</html> 