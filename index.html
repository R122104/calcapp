<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Çè„Åè„Çè„ÅèË®àÁÆó„Ç´„Éº„Éâ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Hiragino Maru Gothic ProN', 'Rounded Mplus 1c', 'Kosugi Maru', sans-serif;
        }

        body {
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
        }

        .app-container {
            width: 100%;
            max-width: 380px;
            margin: 0 auto;
        }

        .card {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* „Çπ„Çø„Éº„ÉàÁîªÈù¢ */
        #start-screen {
            padding: 20px;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .big-emoji {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .settings-options {
            margin-bottom: 20px;
        }

        .setting-row {
            margin-bottom: 15px;
        }

        .setting-label {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .setting-buttons {
            display: flex;
            gap: 10px;
        }

        .option-btn, .op-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid #dee2e6;
            background-color: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
        }

        .option-btn.active, .op-btn.active {
            background-color: #4285f4;
            color: white;
            font-weight: bold;
        }

        .start-btn {
            width: 100%;
            padding: 12px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        /* „Ç≤„Éº„É†ÁîªÈù¢ */
        #game-screen {
            display: none;
        }

        /* „Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜ */
        .header {
            padding: 10px;
        }

        .title {
            background-color: #4285f4;
            color: white;
            padding: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .emoji {
            font-size: 28px;
            margin-right: 10px;
        }

        h1 {
            font-size: 22px;
            font-weight: 700;
            margin: 0;
        }

        /* ÈÄ≤Êçó„Éê„Éº */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background-color: #f1f3f5;
            border-radius: 8px;
        }

        .progress-text {
            font-weight: bold;
        }

        .points {
            background-color: #4285f4;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        /* ÂïèÈ°å„Ç´„Éº„Éâ */
        .problem-card {
            background-color: #e7f5ff;
            margin: 10px;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .problem {
            font-size: 32px;
            font-weight: bold;
        }

        .number {
            display: inline-block;
            background-color: white;
            width: 50px;
            height: 50px;
            line-height: 50px;
            border-radius: 8px;
            margin: 0 5px;
        }

        .operator {
            display: inline-block;
            margin: 0 5px;
        }

        .equals {
            display: inline-block;
            margin: 0 5px;
        }

        .answer-placeholder {
            display: inline-block;
            background-color: #fa5252;
            color: white;
            width: 50px;
            height: 50px;
            line-height: 50px;
            border-radius: 8px;
            margin: 0 5px;
        }

        /* ÂõûÁ≠î„Ç®„É™„Ç¢ */
        .answer-area {
            padding: 0 10px 15px;
        }

        .message-box {
            text-align: center;
            margin-bottom: 15px;
            padding: 8px;
            border-radius: 8px;
            background-color: #f1f3f5;
        }

        .message-box.correct {
            background-color: #ebfbee;
            color: #12b886;
        }

        .message-box.incorrect {
            background-color: #fff5f5;
            color: #fa5252;
        }

        /* Êï∞Â≠ó„Ç≠„Éº„Éë„ÉÉ„Éâ */
        .number-pad {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .number-row {
            display: flex;
            gap: 8px;
        }

        .number-key, .check-answer-btn {
            flex: 1;
            aspect-ratio: 1;
            padding: 10px;
            border: 1px solid #dee2e6;
            background-color: white;
            border-radius: 8px;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
        }

        .check-answer-btn {
            flex: 2;
            aspect-ratio: initial;
            background-color: #4285f4;
            color: white;
            font-size: 16px;
        }

        /* ÁµêÊûúÁîªÈù¢ */
        #result-screen {
            display: none;
            padding: 15px;
        }

        .result-header {
            background-color: #fff3bf;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
        }

        .result-stats {
            background-color: #f1f3f5;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .stat-label {
            font-weight: bold;
        }

        .retry-btn, .review-btn {
            width: 100%;
            padding: 12px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 15px;
        }

        #review-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        #review-area h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .review-problem {
            background-color: #f1f3f5;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        /* Ê≠£Ëß£„Éª‰∏çÊ≠£Ëß£Ë°®Á§∫Áî® */
        .correct {
            color: #12b886;
        }

        .incorrect {
            color: #fa5252;
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .pop {
            animation: pop 0.3s;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="card">
            <!-- „Çπ„Çø„Éº„ÉàÁîªÈù¢ -->
            <div id="start-screen">
                <div class="settings-header">
                    <div class="big-emoji">üòä</div>
                    <h2>„Çè„Åè„Çè„ÅèË®àÁÆó„Ç´„Éº„Éâ</h2>
                </div>
                
                <div class="settings-options">
                    <div class="setting-row">
                        <div class="setting-label">„ÇÄ„Åö„Åã„Åó„Åï:</div>
                        <div class="setting-buttons">
                            <button class="option-btn active" id="easy-btn">„Åã„Çì„Åü„Çì</button>
                            <button class="option-btn" id="normal-btn">„Åµ„Å§„ÅÜ</button>
                            <button class="option-btn" id="hard-btn">„ÇÄ„Åö„Åã„Åó„ÅÑ</button>
                        </div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">„ÇÇ„Çì„Å†„ÅÑ„Åô„ÅÜ:</div>
                        <div class="setting-buttons">
                            <button class="option-btn" data-value="5">5</button>
                            <button class="option-btn active" data-value="10">10</button>
                            <button class="option-btn" data-value="20">20</button>
                        </div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">„Åë„ÅÑ„Åï„Çì„Åó„ÇÖ„Çã„ÅÑ:</div>
                        <div class="setting-buttons">
                            <button class="op-btn active" data-op="+">+</button>
                            <button class="op-btn" data-op="-">-</button>
                            <button class="op-btn" data-op="√ó">√ó</button>
                        </div>
                    </div>
                </div>
                
                <button id="start-btn" class="start-btn">„ÅØ„Åò„ÇÅ„Çã</button>
            </div>

            <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
            <div id="game-screen">
                <!-- „Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜ -->
                <div class="header">
                    <div class="title">
                        <div class="emoji">üòä</div>
                        <h1>„Çè„Åè„Çè„ÅèË®àÁÆó„Ç´„Éº„Éâ</h1>
                    </div>
                    
                    <!-- ÈÄ≤ÊçóË°®Á§∫ -->
                    <div class="progress-bar">
                        <div class="progress-text">
                            <span id="current-problem">1</span> / <span id="total-problems">10</span>
                        </div>
                        <div class="points" id="points">100„Å¥„Çá„ÅÜ</div>
                    </div>
                </div>
                
                <!-- ÂïèÈ°åË°®Á§∫„Ç®„É™„Ç¢ -->
                <div class="problem-card">
                    <div class="problem">
                        <span id="num1" class="number">7</span>
                        <span id="operator" class="operator">+</span>
                        <span id="num2" class="number">5</span>
                        <span class="equals">=</span>
                        <span class="answer-placeholder">?</span>
                    </div>
                </div>
                
                <!-- ÂõûÁ≠îÂÖ•Âäõ„Ç®„É™„Ç¢ -->
                <div class="answer-area">
                    <div class="message-box" id="message-box">„Åì„Åü„Åà„Çí„ÅÑ„Çå„Å¶„Å≠</div>
                    
                    <!-- Êï∞Â≠ó„Ç≠„Éº„Éë„ÉÉ„Éâ -->
                    <div class="number-pad">
                        <div class="number-row">
                            <button class="number-key" data-value="1">1</button>
                            <button class="number-key" data-value="2">2</button>
                            <button class="number-key" data-value="3">3</button>
                        </div>
                        <div class="number-row">
                            <button class="number-key" data-value="4">4</button>
                            <button class="number-key" data-value="5">5</button>
                            <button class="number-key" data-value="6">6</button>
                        </div>
                        <div class="number-row">
                            <button class="number-key" data-value="7">7</button>
                            <button class="number-key" data-value="8">8</button>
                            <button class="number-key" data-value="9">9</button>
                        </div>
                        <div class="number-row">
                            <button class="number-key" data-value="0">0</button>
                            <button id="check-btn" class="check-answer-btn">„Åì„Åü„Åà„ÅÇ„Çè„Åõ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÁµêÊûúÁîªÈù¢ -->
            <div id="result-screen">
                <div class="result-header">
                    <h2>„Åä„Å§„Åã„Çå„Åï„ÅæÔºÅ</h2>
                    <div class="result-message">„Å®„Å¶„ÇÇ„Åò„Çá„ÅÜ„Åö„Å´„Åß„Åç„Åü„Å≠ÔºÅ</div>
                </div>
                
                <div class="result-stats">
                    <div class="stat-row">
                        <div class="stat-label">„Åõ„ÅÑ„Åã„ÅÑ:</div>
                        <div class="stat-value"><span id="correct-count">8</span>/<span id="total-count">10</span>„ÇÇ„Çì</div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-label">„Åã„Åã„Å£„Åü„Åò„Åã„Çì:</div>
                        <div class="stat-value"><span id="minutes">2</span>„Åµ„Çì<span id="seconds">15</span>„Å≥„Çá„ÅÜ</div>
                    </div>
                </div>
                
                <button id="retry-btn" class="retry-btn">„ÇÇ„ÅÜ„ÅÑ„Å°„Å© „ÇÑ„Çã</button>
                
                <!-- ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÅÆÂæ©Áøí„Ç®„É™„Ç¢ -->
                <div id="review-area">
                    <h3>„Åæ„Å°„Åå„Åà„Åü„ÇÇ„Çì„Å†„ÅÑ</h3>
                    <div id="review-problems"></div>
                    <button id="review-btn" class="review-btn">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÇÑ„Å£„Å¶„Åø„Çã</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentNum1 = 0;
        let currentNum2 = 0;
        let currentOperator = '+';
        let correctCount = 0;
        let totalCount = 0;
        let maxProblems = 10;
        let startTime = 0;
        let wrongProblems = [];
        let currentAnswer = '';
        let problemResults = [];
        let userSettings = {
            difficulty: 'easy',
            operators: ['+'],
            problemCount: 10,
            maxNumber: 10
        };

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', init);

        function init() {
            // Êï∞Â≠ó„Ç≠„Éº„Éë„ÉÉ„Éâ„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            const numberKeys = document.querySelectorAll('.number-key');
            numberKeys.forEach(key => {
                key.addEventListener('click', () => {
                    const number = key.getAttribute('data-value');
                    addNumberToAnswer(number);
                });
            });

            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„Çø„É≥
            const checkButton = document.getElementById('check-btn');
            checkButton.addEventListener('click', checkAnswer);

            // „Çπ„Çø„Éº„Éà„Éú„Çø„É≥
            const startButton = document.getElementById('start-btn');
            startButton.addEventListener('click', startGame);

            // „É™„Éà„É©„Ç§„Éú„Çø„É≥
            const retryButton = document.getElementById('retry-btn');
            retryButton.addEventListener('click', () => {
                hideScreen('result-screen');
                showScreen('start-screen');
            });

            // Âæ©Áøí„Éú„Çø„É≥
            const reviewButton = document.getElementById('review-btn');
            reviewButton.addEventListener('click', reviewWrongProblems);

            // Èõ£ÊòìÂ∫¶Ë®≠ÂÆö
            const easyBtn = document.getElementById('easy-btn');
            const normalBtn = document.getElementById('normal-btn');
            const hardBtn = document.getElementById('hard-btn');
            
            easyBtn.addEventListener('click', () => setDifficulty('easy'));
            normalBtn.addEventListener('click', () => setDifficulty('normal'));
            hardBtn.addEventListener('click', () => setDifficulty('hard'));

            // ÊºîÁÆóÂ≠ê„Éú„Çø„É≥
            const opButtons = document.querySelectorAll('.op-btn');
            opButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const op = btn.getAttribute('data-op');
                    toggleOperator(btn, op);
                });
            });

            // ÂïèÈ°åÊï∞„Éú„Çø„É≥
            const optionButtons = document.querySelectorAll('.option-btn[data-value]');
            optionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const value = parseInt(btn.getAttribute('data-value'));
                    setProblemCount(btn, value);
                });
            });

            // „Ç≠„Éº„Éú„Éº„ÉâÂÖ•Âäõ
            document.addEventListener('keydown', handleKeyboardInput);

            // ÂàùÊúüÁä∂ÊÖã„ÅÆË®≠ÂÆö
            showScreen('start-screen');
            hideScreen('game-screen');
            hideScreen('result-screen');
        }

        // ÁîªÈù¢Ë°®Á§∫Âàá„ÇäÊõø„Åà
        function showScreen(screenId) {
            document.getElementById(screenId).style.display = 'block';
        }

        function hideScreen(screenId) {
            document.getElementById(screenId).style.display = 'none';
        }

        // Èõ£ÊòìÂ∫¶Ë®≠ÂÆö
        function setDifficulty(difficulty) {
            userSettings.difficulty = difficulty;
            
            // „Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('#easy-btn, #normal-btn, #hard-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(difficulty + '-btn').classList.add('active');
            
            if (difficulty === 'easy') {
                userSettings.maxNumber = 10;
            } else if (difficulty === 'normal') {
                userSettings.maxNumber = 20;
            } else {
                userSettings.maxNumber = 30;
            }
        }

        // ÊºîÁÆóÂ≠êË®≠ÂÆö
        function toggleOperator(button, operator) {
            button.classList.toggle('active');
            
            if (button.classList.contains('active')) {
                // ÊºîÁÆóÂ≠ê„ÇíËøΩÂä†
                if (!userSettings.operators.includes(operator)) {
                    userSettings.operators.push(operator);
                }
            } else {
                // ÊºîÁÆóÂ≠ê„ÇíÂâäÈô§Ôºà„Åü„Å†„ÅóÂ∞ë„Å™„Åè„Å®„ÇÇ1„Å§„ÅØÂøÖË¶ÅÔºâ
                if (userSettings.operators.length > 1) {
                    userSettings.operators = userSettings.operators.filter(op => op !== operator);
                } else {
                    // ÊúÄÂæå„ÅÆ1„Å§„ÅØÂâäÈô§„Åß„Åç„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
                    button.classList.add('active');
                }
            }
        }

        // ÂïèÈ°åÊï∞Ë®≠ÂÆö
        function setProblemCount(button, count) {
            userSettings.problemCount = count;
            maxProblems = count;
            
            // „Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.option-btn[data-value]').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        function startGame() {
            // ÊºîÁÆóÂ≠ê„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç
            if (userSettings.operators.length === 0) {
                alert('„Åë„ÅÑ„Åï„Çì„ÅÆ„Åó„ÇÖ„Çã„ÅÑ„Çí „Åà„Çâ„Çì„Åß„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // „Ç´„Ç¶„É≥„Çø„Éº„Çí„É™„Çª„ÉÉ„Éà
            correctCount = 0;
            totalCount = 0;
            problemResults = [];
            wrongProblems = [];
            
            // ÊúÄÂ§ßÂïèÈ°åÊï∞„ÅÆË®≠ÂÆö
            maxProblems = userSettings.problemCount;
            document.getElementById('total-problems').textContent = maxProblems;
            
            // ÈñãÂßãÊôÇÈñì„ÇíË®òÈå≤
            startTime = Date.now();
            
            // ÁîªÈù¢Âàá„ÇäÊõø„Åà
            hideScreen('start-screen');
            hideScreen('result-screen');
            showScreen('game-screen');
            
            // ÊúÄÂàù„ÅÆÂïèÈ°å„ÇíÁîüÊàê
            generateProblem();
        }

        // ÂïèÈ°åÁîüÊàê
        function generateProblem() {
            // ÂïèÈ°åÊï∞„Å´ÈÅî„Åó„Åü„Çâ„Ç≤„Éº„É†ÁµÇ‰∫Ü
            if (totalCount >= maxProblems) {
                endGame();
                return;
            }
            
            // ÂïèÈ°åÁï™Âè∑„ÇíÊõ¥Êñ∞
            document.getElementById('current-problem').textContent = totalCount + 1;
            
            const maxNumber = userSettings.maxNumber;
            
            // ÁèæÂú®„ÅÆÂÖ•Âäõ„Çí„É™„Çª„ÉÉ„Éà
            currentAnswer = '';
            document.querySelector('.answer-placeholder').textContent = '?';
            
            // „É°„ÉÉ„Çª„Éº„Ç∏„ÇíÊõ¥Êñ∞
            document.getElementById('message-box').textContent = '„Åì„Åü„Åà„Çí„ÅÑ„Çå„Å¶„Å≠';
            document.getElementById('message-box').className = 'message-box';
            
            // ÊºîÁÆóÂ≠ê„ÅÆÈÅ∏Êäû
            currentOperator = userSettings.operators[Math.floor(Math.random() * userSettings.operators.length)];
            document.getElementById('operator').textContent = currentOperator;
            
            if (currentOperator === '+') {
                // „Åü„Åó„Åñ„Çì„ÅÆÂ†¥Âêà
                currentNum1 = Math.floor(Math.random() * maxNumber) + 1;
                currentNum2 = Math.floor(Math.random() * maxNumber) + 1;
            } else if (currentOperator === '-') {
                // „Å≤„Åç„Åñ„Çì„ÅÆÂ†¥ÂêàÔºàÁ≠î„Åà„ÅåË≤†„Å´„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´Ôºâ
                currentNum1 = Math.floor(Math.random() * maxNumber) + 1;
                currentNum2 = Math.floor(Math.random() * currentNum1) + 1;
            } else if (currentOperator === '√ó') {
                // „Åã„Åë„Åñ„Çì„ÅÆÂ†¥Âêà
                currentNum1 = Math.floor(Math.random() * (maxNumber / 2)) + 1;
                currentNum2 = Math.floor(Math.random() * (maxNumber / 2)) + 1;
            }
            
            document.getElementById('num1').textContent = currentNum1;
            document.getElementById('num2').textContent = currentNum2;
            
            // ÊÆã„Çä„Éù„Ç§„É≥„ÉàË°®Á§∫
            document.getElementById('points').textContent = `${(maxProblems - totalCount) * 10}„Å¥„Çá„ÅÜ`;
        }

        // Êï∞Â≠óÂÖ•Âäõ
        function addNumberToAnswer(number) {
            // 2Ê°Å‰ª•‰∏ä„Å´„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
            if (currentAnswer.length < 2) {
                currentAnswer += number;
                const answerPlaceholder = document.querySelector('.answer-placeholder');
                answerPlaceholder.textContent = currentAnswer;
                answerPlaceholder.classList.add('pop');
                setTimeout(() => {
                    answerPlaceholder.classList.remove('pop');
                }, 300);
            }
        }

        // Á≠î„ÅàÂêà„Çè„Åõ
        function checkAnswer() {
            if (currentAnswer === '') {
                document.getElementById('message-box').textContent = '„Åì„Åü„Åà„Çí „Å´„ÇÖ„ÅÜ„Çä„Çá„Åè„Åó„Å¶„Å≠';
                return;
            }
            
            let correctAnswer;
            if (currentOperator === '+') {
                correctAnswer = currentNum1 + currentNum2;
            } else if (currentOperator === '-') {
                correctAnswer = currentNum1 - currentNum2;
            } else if (currentOperator === '√ó') {
                correctAnswer = currentNum1 * currentNum2;
            }
            
            const isCorrect = parseInt(currentAnswer) === correctAnswer;
            
            // ÁµêÊûú„ÇíË®òÈå≤
            totalCount++;
            if (isCorrect) {
                correctCount++;
                document.getElementById('message-box').textContent = '„Åõ„ÅÑ„Åã„ÅÑÔºÅ';
                document.getElementById('message-box').className = 'message-box correct';
            } else {
                document.getElementById('message-box').textContent = `„Åñ„Çì„Å≠„ÇìÔºÅ „Åì„Åü„Åà„ÅØ ${correctAnswer}`;
                document.getElementById('message-box').className = 'message-box incorrect';
                
                // ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÇíË®òÈå≤
                wrongProblems.push({
                    num1: currentNum1,
                    num2: currentNum2,
                    operator: currentOperator,
                    correctAnswer: correctAnswer,
                    userAnswer: currentAnswer
                });
            }
            
            // ÁµêÊûú„ÇíÈÖçÂàó„Å´‰øùÂ≠ò
            problemResults.push({
                num1: currentNum1,
                num2: currentNum2,
                operator: currentOperator,
                userAnswer: parseInt(currentAnswer),
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            });
            
            // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÊ¨°„ÅÆÂïèÈ°å„Å∏
            setTimeout(() => {
                generateProblem();
            }, 1000);
        }

        // „Ç≤„Éº„É†ÁµÇ‰∫Ü
        function endGame() {
            const endTime = Date.now();
            const totalTimeInSeconds = Math.floor((endTime - startTime) / 1000);
            const minutes = Math.floor(totalTimeInSeconds / 60);
            const seconds = totalTimeInSeconds % 60;
            
            // ÁµêÊûúË°®Á§∫
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('total-count').textContent = totalCount;
            document.getElementById('minutes').textContent = minutes;
            document.getElementById('seconds').textContent = seconds;
            
            // ÁµêÊûú„É°„ÉÉ„Çª„Éº„Ç∏
            const resultMessageElement = document.querySelector('.result-message');
            if (correctCount === totalCount) {
                resultMessageElement.textContent = '„Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅ„Åô„Åî„ÅÑ„Å≠ÔºÅ';
            } else if (correctCount / totalCount >= 0.8) {
                resultMessageElement.textContent = '„Å®„Å¶„ÇÇ„Åò„Çá„ÅÜ„Åö„Å´„Åß„Åç„Åü„Å≠ÔºÅ';
            } else if (correctCount / totalCount >= 0.6) {
                resultMessageElement.textContent = '„Çà„Åè„Åå„Çì„Å∞„Å£„Åü„Å≠ÔºÅ';
            } else {
                resultMessageElement.textContent = '„Å§„Åé„ÅØ„ÇÇ„Å£„Å®„Åå„Çì„Å∞„Çç„ÅÜÔºÅ';
            }
            
            // ÁîªÈù¢Âàá„ÇäÊõø„Åà
            hideScreen('game-screen');
            showScreen('result-screen');
            
            // ÈñìÈÅï„Åà„ÅüÂïèÈ°å„Åå„ÅÇ„Çå„Å∞Âæ©Áøí„Ç®„É™„Ç¢„ÇíË°®Á§∫
            if (wrongProblems.length > 0) {
                showWrongProblems();
            } else {
                document.getElementById('review-area').style.display = 'none';
            }
        }

        // ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÇíË°®Á§∫
        function showWrongProblems() {
            const reviewArea = document.getElementById('review-area');
            const reviewProblemsElement = document.getElementById('review-problems');
            
            reviewProblemsElement.innerHTML = '';
            
            wrongProblems.forEach(problem => {
                const problemElement = document.createElement('div');
                problemElement.className = 'review-problem';
                problemElement.innerHTML = `
                    ${problem.num1} ${problem.operator} ${problem.num2} = <span class="correct">${problem.correctAnswer}</span>
                    („ÅÇ„Å™„Åü: <span class="incorrect">${problem.userAnswer}</span>)
                `;
                reviewProblemsElement.appendChild(problemElement);
            });
            
            reviewArea.style.display = 'block';
        }

        // ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÇíÂæ©Áøí
        function reviewWrongProblems() {
            // ÈñìÈÅï„Åà„ÅüÂïèÈ°å„Å†„Åë„Åß„Ç≤„Éº„É†„ÇíÂÜçÈñã
            maxProblems = wrongProblems.length;
            const tempWrongProblems = [...wrongProblems];
            wrongProblems = [];
            
            // Âæ©Áøí„Ç®„É™„Ç¢„ÇíÈùûË°®Á§∫
            document.getElementById('review-area').style.display = 'none';
            hideScreen('result-screen');
            
            // „Ç≤„Éº„É†ÂÜçÈñã
            startGame();
            
            // ÈÄöÂ∏∏„ÅÆÂïèÈ°åÁîüÊàê„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Å¶ÈñìÈÅï„Åà„ÅüÂïèÈ°å„Çí‰Ωø„ÅÜ
            const originalGenerateProblem = generateProblem;
            generateProblem = function() {
                if (totalCount >= maxProblems || tempWrongProblems.length === 0) {
                    endGame();
                    return;
                }
                
                // ÂïèÈ°åÁï™Âè∑„ÇíÊõ¥Êñ∞
                document.getElementById('current-problem').textContent = totalCount + 1;
                
                const problem = tempWrongProblems.pop();
                currentNum1 = problem.num1;
                currentNum2 = problem.num2;
                currentOperator = problem.operator;
                
                document.getElementById('num1').textContent = currentNum1;
                document.getElementById('num2').textContent = currentNum2;
                document.getElementById('operator').textContent = currentOperator;
                
                // ÊÆã„Çä„Éù„Ç§„É≥„ÉàË°®Á§∫
                document.getElementById('points').textContent = `${(maxProblems - totalCount) * 10}„Å¥„Çá„ÅÜ`;
            }
        }
    </script>
</body>
</html> 